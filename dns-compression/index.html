<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.24.1"/><meta name="description" content="When writing my DNS client &quot;Who are you?&quot; i had no idea that there was compression built into DNS messages. This blog post will explain how compression in DNS messages work and how i went about solving it." data-gatsby-head="true"/><meta property="og:title" content="Compression in DNS messages" data-gatsby-head="true"/><meta property="og:description" content="When writing my DNS client &quot;Who are you?&quot; i had no idea that there was compression built into DNS messages. This blog post will explain how compression in DNS messages work and how i went about solving it." data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta name="twitter:card" content="summary" data-gatsby-head="true"/><meta name="twitter:creator" content="tandolf" data-gatsby-head="true"/><meta name="twitter:title" content="Compression in DNS messages" data-gatsby-head="true"/><meta name="twitter:description" content="When writing my DNS client &quot;Who are you?&quot; i had no idea that there was compression built into DNS messages. This blog post will explain how compression in DNS messages work and how i went about solving it." data-gatsby-head="true"/><style data-href="/styles.8c1f2202249a84235a8e.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--global-font-size:15px;--global-line-height:1.4em;--global-space:10px;--font-stack:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;--mono-font-stack:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;--background-color:#fff;--page-width:60em;--font-color:#151515;--invert-font-color:#fff;--primary-color:#1a95e0;--secondary-color:#727578;--error-color:#d20962;--progress-bar-background:#727578;--progress-bar-fill:#151515;--code-bg-color:#e8eff2;--input-style:solid;--display-h1-decoration:none}*{box-sizing:border-box;text-rendering:geometricPrecision}::selection{background:var(--primary-color);color:var(--invert-font-color)}body{word-wrap:break-word;background-color:var(--background-color);color:var(--font-color);font-family:var(--font-stack);font-size:var(--global-font-size);margin:0}.logo,body,h1,h2,h3,h4,h5,h6{line-height:var(--global-line-height)}a{color:var(--primary-color);cursor:pointer;text-decoration:none}a:hover{background-color:var(--primary-color);color:var(--invert-font-color)}em{color:var(--font-color);font-family:var(--font-stack);font-size:var(--global-font-size);font-style:italic}blockquote,code,em,strong{line-height:var(--global-line-height)}.logo,blockquote,code,footer,h1,h2,h3,h4,h5,h6,header,li,ol,p,section,ul{float:none;margin:0;padding:0}.logo,blockquote,h1,ol,p,ul{margin-bottom:calc(var(--global-space)*2);margin-top:calc(var(--global-space)*2)}.logo,h1{display:inline-block;display:table-cell;font-weight:600;margin:0;overflow:hidden;padding:calc(var(--global-space)*2) 0 calc(var(--global-space)*2);position:relative}h1:after{bottom:5px;content:"====================================================================================================";display:var(--display-h1-decoration);left:0;position:absolute}.logo+*,h1+*{margin-top:0}h2,h3,h4,h5,h6{font-weight:600;margin-bottom:var(--global-line-height);position:relative}blockquote{overflow:hidden;padding-left:2ch;position:relative}blockquote:after{color:#9ca2ab;content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";left:0;line-height:var(--global-line-height);position:absolute;top:0;white-space:pre}code{background-color:var(--code-bg-color);font-family:var(--mono-font-stack);font-weight:inherit}code:after,code:before{content:"`";display:inline}pre code:after,pre code:before{content:""}pre{word-wrap:break-word;background-color:var(--background-color);border:1px solid var(--secondary-color);color:var(--secondary-color);display:block;padding:var(--global-space);white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-break:break-all}pre code{display:inline-block;font-family:var(--mono-font-stack);margin:0;min-width:100%;overflow-x:scroll;padding:0}.terminal .logo,.terminal blockquote,.terminal code,.terminal h1,.terminal h2,.terminal h3,.terminal h4,.terminal h5,.terminal h6,.terminal strong{color:var(--font-color);font-family:var(--font-stack);font-size:var(--global-font-size);font-style:normal}.terminal-prompt{position:relative;white-space:nowrap}.terminal-prompt:before{content:"> "}.terminal-prompt:after{-webkit-animation:cursor .8s infinite;animation:cursor .8s infinite;background:var(--primary-color);border-radius:0;bottom:-2px;content:"";display:inline-block;height:1em;margin-left:.2em;position:relative;width:3px}@-webkit-keyframes cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}li,li>ul>li{display:block;padding-left:calc(var(--global-space)*2);position:relative}nav>ul>li{padding-left:0}li:after{left:0;position:absolute;top:0}ul>li:after{content:"-"}nav ul>li:after{content:""}ol li:before{content:counters(item,".") ". ";counter-increment:item}ol ol li:before{content:counters(item,".") " ";counter-increment:item}.terminal-menu li:after,.terminal-menu li:before{display:none}ol{counter-reset:item}ol li:nth-child(n+10):after{left:-7px}ol ol{margin-bottom:0;margin-top:0}.terminal-menu{width:100%}.terminal-nav{align-items:flex-start;display:flex;flex-direction:column}ul ul{margin-bottom:0;margin-top:0}.terminal-menu ul{display:flex;flex-direction:column;flex-grow:1;font-size:var(--global-font-size);list-style-type:none;margin-top:0;padding:0!important;width:100%}.terminal-menu li{display:flex;margin:0 0 .5em;padding:0}ol.terminal-toc li{border-bottom:1px dotted var(--secondary-color);margin-bottom:15px;padding:0}.terminal-menu li:last-child{margin-bottom:0}ol.terminal-toc li a{background:var(--background-color);margin:4px 4px 4px 0;padding-right:4px;position:relative;text-align:left;top:6px}.terminal-menu li a:not(.btn){border:none;color:var(--secondary-color);display:block;text-decoration:none;width:100%}.terminal-menu li a.active{color:var(--font-color)}.terminal-menu li a:hover{background:0 0;color:inherit}ol.terminal-toc li:before{background:var(--background-color);bottom:-8px;content:counters(item,".") ". ";counter-increment:item;padding:4px 0 4px 4px;position:absolute;right:0}ol.terminal-toc li a:hover{background:var(--primary-color);color:var(--invert-font-color)}hr{border:0;border-bottom:1px dashed var(--secondary-color);margin:calc(var(--global-space)*4) 0;overflow:hidden;position:relative}p{color:var(--global-font-color);margin:0 0 var(--global-line-height)}.container{max-width:var(--page-width)}.container,.container-fluid{margin:0 auto;padding:0 calc(var(--global-space)*2)}img{width:100%}.progress-bar{background-color:var(--progress-bar-background);height:8px;margin:12px 0}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:var(--progress-bar-fill);height:100%;position:relative;transition:width .3s ease;width:0}.progress-bar-filled:before{border:6px solid transparent;border-top:6px solid var(--progress-bar-fill);content:"";position:absolute;right:-6px;top:-12px}.progress-bar-filled:after{border:6px solid transparent;color:var(--progress-bar-fill);content:attr(data-filled);display:block;font-size:12px;position:absolute;right:0;top:-38px;-webkit-transform:translateX(50%);transform:translateX(50%);white-space:nowrap}.progress-bar-no-arrow>.progress-bar-filled:after,.progress-bar-no-arrow>.progress-bar-filled:before{content:"";display:none;opacity:0;visibility:hidden}table{border-collapse:collapse;color:var(--font-color);font-size:var(--global-font-size);margin:var(--global-line-height) 0;width:100%}table td,table th{border:1px solid var(--font-color);font-size:1em;line-height:var(--global-line-height);padding:calc(var(--global-space)/2);vertical-align:top}table thead th{font-size:1em}table tfoot tr th{font-weight:500}table caption{font-size:1em;margin:0 0 1em}table tbody td:first-child{color:var(--secondary-color);font-weight:700}.form{width:100%}fieldset{border:1px solid var(--font-color);padding:1em}label{color:var(--font-color);font-size:1em}input[type=email],input[type=number],input[type=password],input[type=search],input[type=text]{-webkit-appearance:none;border:1px var(--input-style) var(--font-color);border-radius:0;font-family:var(--font-stack);font-size:1em;padding:.7em .5em;width:100%}input[type=email]:active,input[type=email]:focus,input[type=number]:active,input[type=number]:focus,input[type=password]:active,input[type=password]:focus,input[type=search]:active,input[type=search]:focus,input[type=text]:active,input[type=text]:focus{-webkit-appearance:none;border:1px solid var(--font-color);outline:0}input[type=email]:not(:placeholder-shown):invalid,input[type=number]:not(:placeholder-shown):invalid,input[type=password]:not(:placeholder-shown):invalid,input[type=search]:not(:placeholder-shown):invalid,input[type=text]:not(:placeholder-shown):invalid{border-color:var(--error-color)}input,textarea{background-color:var(--background-color);color:var(--font-color)}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:var(--secondary-color)!important;opacity:1}input::placeholder,textarea::placeholder{color:var(--secondary-color)!important;opacity:1}textarea{-webkit-appearance:none;border:1px var(--input-style) var(--font-color);border-radius:0;font-family:var(--font-stack);font-size:1em;height:auto;padding:.5em;resize:none;width:100%}textarea:focus{-webkit-appearance:none;border:1px solid var(--font-color);outline:0}textarea:not(:placeholder-shown):invalid{border-color:var(--error-color)}input:-webkit-autofill,input:-webkit-autofill:focus textarea:-webkit-autofill,input:-webkit-autofill:hover,select:-webkit-autofill,select:-webkit-autofill:focus,select:-webkit-autofill:hover,textarea:-webkit-autofill:hover textarea:-webkit-autofill:focus{-webkit-text-fill-color:var(--font-color);border:1px solid var(--font-color);box-shadow:0 0 0 1000px var(--invert-font-color) inset;-webkit-box-shadow:0 0 0 1000px var(--invert-font-color) inset;-webkit-transition:background-color 5000s ease-in-out 0s;transition:background-color 5000s ease-in-out 0s}.form-group{margin-bottom:var(--global-line-height);overflow:auto}.btn{align-items:center;border-style:solid;border-width:1px;cursor:pointer;display:inline-flex;font-family:inherit;font-size:1em;justify-content:center;outline:0;padding:.65em 2em;position:relative;-webkit-user-select:none;user-select:none;z-index:1}.btn:active{box-shadow:none}.btn.btn-ghost{background-color:transparent;border-color:var(--font-color);color:var(--font-color)}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:var(--tertiary-color);color:var(--tertiary-color);z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{display:flex;width:100%}.btn-default{background-color:var(--font-color);border-color:var(--invert-font-color);color:var(--invert-font-color)}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:var(--secondary-color);color:var(--invert-font-color)}.btn-default.btn-ghost:focus,.btn-default.btn-ghost:hover{border-color:var(--secondary-color);color:var(--secondary-color);z-index:2}.btn-error{background-color:var(--error-color);border:1px solid var(--error-color);color:var(--invert-font-color)}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:var(--error-color);border-color:var(--error-color)}.btn-error.btn-ghost,.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:var(--error-color);color:var(--error-color)}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{z-index:2}.btn-primary{background-color:var(--primary-color);border:1px solid var(--primary-color);color:var(--invert-font-color)}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:var(--primary-color);border-color:var(--primary-color)}.btn-primary.btn-ghost,.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:var(--primary-color);color:var(--primary-color)}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{z-index:2}.btn-small{font-size:.9em!important;padding:.5em 1.3em!important}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.terminal-card{border:1px solid var(--secondary-color)}.terminal-card>header{background-color:var(--secondary-color);color:var(--invert-font-color);padding:.5em 0;text-align:center}.terminal-card>div:first-of-type{padding:var(--global-space)}.terminal-timeline{padding-left:70px;position:relative}.terminal-timeline:before{background:var(--secondary-color);content:" ";display:inline-block;height:100%;left:35px;position:absolute;width:2px;z-index:400}.terminal-timeline .terminal-card{margin-bottom:25px}.terminal-timeline .terminal-card:before{background:var(--invert-font-color);border:2px solid var(--secondary-color);content:" ";display:inline-block;height:15px;left:26px;margin-top:25px;position:absolute;width:15px;z-index:400}.terminal-alert{border:1px solid var(--font-color);color:var(--font-color);margin-bottom:var(--global-space);padding:1em}.terminal-alert-error{border-color:var(--error-color);color:var(--error-color)}.terminal-alert-primary{border-color:var(--primary-color);color:var(--primary-color)}@media screen and (max-width:960px){label{display:block;width:100%}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){form{width:100%}}@media only screen and (min-width:30em){.terminal-menu ul,.terminal-nav{align-items:center;flex-direction:row}.terminal-menu ul{justify-content:flex-end;justify-items:flex-end;margin-top:calc(var(--global-space)*2)}.terminal-menu li{margin:0 2em 0 0}.terminal-menu li:last-child{margin-right:0}}.terminal-media:not(:last-child){margin-bottom:1.25rem}.terminal-media-left{padding-right:var(--global-space)}.terminal-media-left,.terminal-media-right{display:table-cell;vertical-align:top}.terminal-media-right{padding-left:var(--global-space)}.terminal-media-body{display:table-cell;vertical-align:top}.terminal-media-heading{font-size:1em;font-weight:700}.terminal-media-content{margin-top:.3rem}.terminal-placeholder{background-color:var(--secondary-color);border:1px solid var(--secondary-color);color:var(--font-color);font-size:1rem;text-align:center}figure>img{padding:0}.terminal-avatarholder{height:calc(var(--global-space)*5);width:calc(var(--global-space)*5)}.terminal-avatarholder img{padding:0}figure{margin:0}figure>figcaption{color:var(--secondary-color);text-align:center}.hljs{background:var(--block-background-color);color:var(--font-color);display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:var(--secondary-color)}.hljs-variable{color:var(--font-color)}.hljs-built_in,.hljs-keyword,.hljs-name,.hljs-selector-tag,.hljs-tag{color:var(--primary-color)}.hljs-addition,.hljs-attribute,.hljs-literal,.hljs-section,.hljs-string,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type{color:var(--secondary-color)}.hljs-deletion,.hljs-meta,.hljs-selector-attr,.hljs-selector-pseudo{color:var(--primary-color)}.hljs-doctag{color:var(--secondary-color)}.hljs-attr,.hljs-bullet,.hljs-link,.hljs-symbol{color:var(--primary-color)}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><title data-gatsby-head="true">Compression in DNS messages | Gatsby Starter Blog</title><style data-styled="" data-styled-version="5.3.6">.copXrJ{border-left-width:8px;border-left-style:solid;border-left-color:var(--dark-warning-color);border-radius :5px;background-color:var(--warning-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px 16px 0px 16px;margin-bottom:21px;color:var(--font-dark-color);}/*!sc*/
.copXrJ div{font-size:undefinedpx;line-height:1.2em;}/*!sc*/
.copXrJ em{color:var(--font-dark-color);}/*!sc*/
.copXrJ a{-webkit-text-decoration:underline;text-decoration:underline;color:var(--font-dark-color);}/*!sc*/
data-styled.g1[id="AttentionBox__StyledWrapper-sc-y20oae-0"]{content:"copXrJ,"}/*!sc*/
.gRbVsB{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-transform:uppercase;font-weight:bolder;margin-bottom:5px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g2[id="AttentionBox__Header-sc-y20oae-1"]{content:"gRbVsB,"}/*!sc*/
.fWYNwT code{padding-left:5px;padding-right:5px;background-color:green;}/*!sc*/
data-styled.g4[id="AttentionBox__Content-sc-y20oae-3"]{content:"fWYNwT,"}/*!sc*/
.facmim{margin-right:7px;margin-bottom:0px;}/*!sc*/
data-styled.g5[id="AttentionBox__Icon-sc-y20oae-4"]{content:"facmim,"}/*!sc*/
.crIFBs{border-radius :5px;background-color:var(--header-font-color);display:inline-block;margin-right:6px;}/*!sc*/
data-styled.g7[id="Tag__StyledWrapper-sc-1wufizg-0"]{content:"crIFBs,"}/*!sc*/
.cjpKMj{font-size:14px;text-align:center;margin:2px 10px 2px;}/*!sc*/
data-styled.g8[id="Tag__Text-sc-1wufizg-1"]{content:"cjpKMj,"}/*!sc*/
.dnVzXH{margin-bottom:10px;}/*!sc*/
data-styled.g9[id="tagSection__StyledWrapper-sc-1aa460q-0"]{content:"dnVzXH,"}/*!sc*/
:root{--global-font-size:20px;--global-line-height:1.4em;--global-space:10px;--font-stack:Ubuntu Mono,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;--mono-font-stack:Ubuntu Mono,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;--background-color:#222225;--page-width:60em;--font-color:#e8e9ed;--font-dark-color:#151515;--header-font-color:#7a3496;--color-gray-700:#BFDBF7;--color-tertiary:#ffdf2c;--invert-font-color:#222225;--secondary-color:#1F7A8C;--tertiary-color:#a3abba;--primary-color:#62c4ff;--error-color:#A31621;--info-color:#62c4ff;--dark-info-color:#0DA2FB;--warning-color:#c7b02c;--dark-warning-color:#766400;--danger-color:#A31621;--dark-danger-color:#580006;--progress-bar-background:#3f3f44;--progress-bar-fill:#62c4ff;--code-bg-color:#3f3f44;--input-style:solid;--display-h1-decoration:none;--spacing-4:4rem;--spacing-0:0;--spacing-16:4rem;}/*!sc*/
body{background-color:var(--background-color);color:var(--font-color);}/*!sc*/
ol li::before{list-style-type:none;margin:0;padding:0;}/*!sc*/
.no-line::after{content:none;}/*!sc*/
code::after,code::before{content:none;}/*!sc*/
.mermaid{margin-top:4em;margin-bottom:4em;}/*!sc*/
.bio-avatar{margin-right:var(--spacing-4);margin-bottom:var(--spacing-0);min-width:50px;border-radius:100%;}/*!sc*/
.bio{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:var(--spacing-16);}/*!sc*/
.bio p{margin-top:0.8em;margin-bottom:var(--spacing-0);}/*!sc*/
h1{display:block;margin-top:150px;font-size:46px;margin-bottom:5px;}/*!sc*/
h2{margin-top:150px;margin-bottom:15px;font-size:36px;}/*!sc*/
h3{margin-bottom:2px;color:var(--dark-warning-color);font-size:26px;}/*!sc*/
h4{margin-bottom:2px;}/*!sc*/
p span{margin-top:30px !important;margin-bottom:30px !important;}/*!sc*/
ol li::before{display:inline;}/*!sc*/
data-styled.g12[id="sc-global-kRUHyZ1"]{content:"sc-global-kRUHyZ1,"}/*!sc*/
.gHswLm{font-size:14px;padding-bottom:10px;}/*!sc*/
data-styled.g13[id="footer__FooterText-sc-ora8l1-0"]{content:"gHswLm,"}/*!sc*/
.kLqMAm{margin:0 auto;max-width:70rem;background-color:var(--background-color);color:var(--font-color);}/*!sc*/
data-styled.g14[id="layout__Wrapper-sc-omnq36-0"]{content:"kLqMAm,"}/*!sc*/
.jJcppV{font-size:18px;}/*!sc*/
data-styled.g15[id="styles__LinkText-sc-ncn1p3-0"]{content:"jJcppV,"}/*!sc*/
.bqQJTT{font-size:18px;color:var(--color-gray-700);}/*!sc*/
data-styled.g16[id="styles__DateText-sc-ncn1p3-1"]{content:"bqQJTT,"}/*!sc*/
</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=a93fb0266df267ec6acb2d350ad1fe0f" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a93fb0266df267ec6acb2d350ad1fe0f"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Wrapper-sc-omnq36-0 kLqMAm"><header class="terminal-nav"><div class="terminal-logo"><div class="logo terminal-prompt"><a class="menu-item" href="/">/home/toerktumlare/</a></div></div><nav class="terminal-menu"><ul><li><a class="menu-item" href="/">/home</a></li><li><a class="menu-item" href="/about">/about</a></li></ul></nav></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header style="margin-bottom:30px"><h1 itemProp="headline">Compression in DNS messages</h1><h3 class="styles__DateText-sc-ncn1p3-1 bqQJTT">December 11, 2023</h3><div class="tagSection__StyledWrapper-sc-1aa460q-0 dnVzXH"><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->rust</p></div><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->dns</p></div><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->networking</p></div></div></header><section itemProp="articleBody"><p>In our <a href="http://blog.toerktumlare.com/anatomy-of-dns/">last post</a> i went through the anatomy of a DNS request, but one thing i left out is that DNS has some inbuilt compression to try to make messages smaller. I thought we should look at that today and show how i solved it in my DNS client <a href="https://github.com/Tandolf/who">“Who are you?”</a>. How to solve this can be done in many ways and this is not in any way an efficient solution, i just wanted to explain how compression in DNS messages works and one way of solving it.</p>
<p>All the examples here are written in rust, but it’s not that much code so it will be quite easy to understand even if you have never coded in rust before.</p>
<h2>So how does it work?</h2>
<p>Compression in DNS messages works in the way that we don’t want to repeat strings multiple times in messages if we don’t have to. By using pointers within our message, we can reference other strings, when we need to write out the string several times.</p>
<p>So what does that actually look like?</p>
<p>If we make a request using <code>who</code> and ask for this site, <code>blog.toerktumlare.com</code>, we get the following response.</p>
<pre class="prism-code language-bash" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">who</span><span class="token plain"> blog.toerktumlare.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">==</span><span class="token plain"> Who are you? </span><span class="token operator">==</span><span class="token plain"> v1.0.0 </span><span class="token operator">==</span><span class="token plain"> blog.toerktumlare.com </span><span class="token operator">==</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">┌Header──────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│OPCODE: Query, STATUS: NoError id: </span><span class="token number">32419</span><span class="token plain">                                │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│qr, rd, ra,                                                             │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│QUERY: </span><span class="token number">1</span><span class="token plain">, ANSWERS: </span><span class="token number">5</span><span class="token plain">, AUTHORITY: </span><span class="token number">0</span><span class="token plain">, ADDITIONAL: </span><span class="token number">0</span><span class="token plain">                       │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">└────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">┌Message─────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│blog.toerktumlare.com             IN       A                            │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">└────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">┌Records─────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│blog.toerktumlare.com     </span><span class="token number">2792</span><span class="token plain">    IN       CNAME   tandolf.github.io    │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│tandolf.github.io         </span><span class="token number">2792</span><span class="token plain">    IN       A       </span><span class="token number">185.199</span><span class="token plain">.110.153      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│tandolf.github.io         </span><span class="token number">2792</span><span class="token plain">    IN       A       </span><span class="token number">185.199</span><span class="token plain">.108.153      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│tandolf.github.io         </span><span class="token number">2792</span><span class="token plain">    IN       A       </span><span class="token number">185.199</span><span class="token plain">.111.153      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│tandolf.github.io         </span><span class="token number">2792</span><span class="token plain">    IN       A       </span><span class="token number">185.199</span><span class="token plain">.109.153      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">└────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">┌Statistics──────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│Query time: </span><span class="token number">4</span><span class="token plain"> msec                                                      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│When: </span><span class="token number">2023</span><span class="token plain">-11-15 </span><span class="token number">18</span><span class="token plain">:11:43                                               │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│Msg SENT: </span><span class="token number">39</span><span class="token plain"> bytes                                                      │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">│Msg RCVD: </span><span class="token number">134</span><span class="token plain"> bytes                                                     │</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">└────────────────────────────────────────────────────────────────────────┘</span></div></pre>
<br/>
<br/>
<br/>
<p>But if we dump the actual raw bytes sent by using <code>tcpdump</code> we get the following.</p>
<pre class="prism-code language-bash" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> tcpdump -i any port </span><span class="token number">53</span><span class="token plain"> -X</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">tcpdump: data </span><span class="token function" style="color:rgb(80, 250, 123)">link</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> LINUX_SLL2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">tcpdump: verbose output suppressed, use -v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> full protocol decode</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">listening on any, link-type LINUX_SLL2 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Linux cooked v2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, snapshot length </span><span class="token number">262144</span><span class="token plain"> bytes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">14</span><span class="token plain">:53:18.781438 lo    In  IP localhost.34041 </span><span class="token operator">&gt;</span><span class="token plain"> localhost.domain: </span><span class="token number">39295</span><span class="token plain">+ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">1au</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> A? blog.toerktumlare.com. </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">62</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0000:  </span><span class="token number">4500</span><span class="token plain"> 005a </span><span class="token number">4296</span><span class="token plain"> 0000 </span><span class="token number">4011</span><span class="token plain"> 39c7 7f00 0001  E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">ZB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.@.9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0010:  7f00 0035 84f9 0035 0046 fe8d 997f 0120  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5.F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0020:  0001 0000 0000 0001 0462 6c6f 670c 746f  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.blog.to</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0030:  </span><span class="token number">6572</span><span class="token plain"> 6b74 756d 6c61 </span><span class="token number">7265</span><span class="token plain"> 0363 6f6d 0000  erktumlare.com</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0040:  0100 0100 0029 04d0 0000 0000 000c 000a  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0050:  0008 450e f971 0825 46f3                 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">q.%F.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">14</span><span class="token plain">:53:18.781770 lo    In  IP localhost.domain </span><span class="token operator">&gt;</span><span class="token plain"> localhost.34041: </span><span class="token number">39295</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain">/0/5 CNAME tandolf.github.io., A </span><span class="token number">185.199</span><span class="token plain">.111.153, A </span><span class="token number">185.199</span><span class="token plain">.108.153, A </span><span class="token number">185.199</span><span class="token plain">.109.153, A </span><span class="token number">185.199</span><span class="token plain">.110.153 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">257</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0000:  </span><span class="token number">4500</span><span class="token plain"> 011d a258 </span><span class="token number">4000</span><span class="token plain"> 0111 d841 7f00 0035  E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">X@</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">A</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0010:  7f00 0001 0035 84f9 0109 ff50 997f </span><span class="token number">8180</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0020:  0001 0005 0000 0005 0462 6c6f 670c 746f  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.blog.to</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0030:  </span><span class="token number">6572</span><span class="token plain"> 6b74 756d 6c61 </span><span class="token number">7265</span><span class="token plain"> 0363 6f6d 0000  erktumlare.com</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0040:  0100 01c0 0c00 0500 0100 0002 </span><span class="token number">1200</span><span class="token plain"> </span><span class="token number">1307</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0050:  </span><span class="token number">7461</span><span class="token plain"> 6e64 6f6c </span><span class="token number">6606</span><span class="token plain"> </span><span class="token number">6769</span><span class="token plain"> </span><span class="token number">7468</span><span class="token plain"> </span><span class="token number">7562</span><span class="token plain"> 0269  tandolf.github.i</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0060:  6f00 c033 0001 0001 0000 0212 0004 b9c7  o</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0070:  6f99 c033 0001 0001 0000 0212 0004 b9c7  o</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0080:  6c99 c033 0001 0001 0000 0212 0004 b9c7  l</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0090:  6d99 c033 0001 0001 0000 0212 0004 b9c7  m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00a0:  6e99 c033 001c 0001 0000 0212 0010 </span><span class="token number">2606</span><span class="token plain">  n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00b0:  50c0 </span><span class="token number">8003</span><span class="token plain"> 0000 0000 0000 0000 0153 c033  P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">S.3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00c0:  001c 0001 0000 0212 0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8001</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00d0:  0000 0000 0000 0000 0153 c033 001c 0001  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.S.3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00e0:  0000 0212 0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8002</span><span class="token plain"> 0000 0000  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00f0:  0000 0000 0153 c033 001c 0001 0000 0212  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.S.3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0100:  0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8000</span><span class="token plain"> 0000 0000 0000 0000  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0110:  0153 0000 29ff d600 0000 0000 00         .S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div></pre>
<br/>
<br/>
<br/>
<p>Thats quite a lot of info, but the top part is the request, and the bottom large part is the response.</p>
<p>If we only look at the response, we can see that the name <code>blog.toerktumlare.com</code> and the string <code>tandolf.github.io</code> are only mentioned once in this entire message.</p>
<pre class="prism-code language-bash" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0000:  </span><span class="token number">4500</span><span class="token plain"> 011d a258 </span><span class="token number">4000</span><span class="token plain"> 0111 d841 7f00 0035  E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">X@</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">A</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0010:  7f00 0001 0035 84f9 0109 ff50 997f </span><span class="token number">8180</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0020:  0001 0005 0000 0005 0462 6c6f 670c 746f  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.blog.to</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0030:  </span><span class="token number">6572</span><span class="token plain"> 6b74 756d 6c61 </span><span class="token number">7265</span><span class="token plain"> 0363 6f6d 0000  erktumlare.com</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0040:  0100 01c0 0c00 0500 0100 0002 </span><span class="token number">1200</span><span class="token plain"> </span><span class="token number">1307</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0050:  </span><span class="token number">7461</span><span class="token plain"> 6e64 6f6c </span><span class="token number">6606</span><span class="token plain"> </span><span class="token number">6769</span><span class="token plain"> </span><span class="token number">7468</span><span class="token plain"> </span><span class="token number">7562</span><span class="token plain"> 0269  tandolf.github.i</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0060:  6f00 c033 0001 0001 0000 0212 0004 b9c7  o</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0070:  6f99 c033 0001 0001 0000 0212 0004 b9c7  o</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0080:  6c99 c033 0001 0001 0000 0212 0004 b9c7  l</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0090:  6d99 c033 0001 0001 0000 0212 0004 b9c7  m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00a0:  6e99 c033 001c 0001 0000 0212 0010 </span><span class="token number">2606</span><span class="token plain">  n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00b0:  50c0 </span><span class="token number">8003</span><span class="token plain"> 0000 0000 0000 0000 0153 c033  P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">S.3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00c0:  001c 0001 0000 0212 0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8001</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00d0:  0000 0000 0000 0000 0153 c033 001c 0001  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.S.3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00e0:  0000 0212 0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8002</span><span class="token plain"> 0000 0000  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x00f0:  0000 0000 0153 c033 001c 0001 0000 0212  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.S.3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0100:  0010 </span><span class="token number">2606</span><span class="token plain"> 50c0 </span><span class="token number">8000</span><span class="token plain"> 0000 0000 0000 0000  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token operator">&amp;</span><span class="token plain">.P</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">	0x0110:  0153 0000 29ff d600 0000 0000 00         .S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"></span></div></pre>
<p>But we could see in our formatted response in the console that the strings were referenced several times and this is because DNS compresses the message to avoid sending the same string multiple times in the message to keep the messages as small as possible. Pointer can usually easy be located by finding the <code>0xc0</code> value. If you see this value, its highly likely to be a pointer (you can for instance see a bunch of pointers at 0x0060-0x00a0).</p>
<div class="AttentionBox__StyledWrapper-sc-y20oae-0 copXrJ"><div class="AttentionBox__Header-sc-y20oae-1 gRbVsB"><div class="AttentionBox__Icon-sc-y20oae-4 facmim"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" style="vertical-align:middle" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M464 720a48 48 0 1 0 96 0 48 48 0 1 0-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"></path></svg></div>warning</div><div class="AttentionBox__Content-sc-y20oae-3 fWYNwT"><p><code>Oxc0</code> pointer value is not always the case, so do not trust this value to always be a pointer. We later are going to find out that a pointer is a 14-bit value, and if the top 6 bits are set to <code>zero</code>, the pointer will indeed have the first byte set as <code>0xc0</code>. But if the pointers offset value is higher than 255 then the <code>0xc0</code> rule potentially doesn’t apply.</p></div></div>
<p>So instead of writing strings several times it instead uses a pointer to point to tokens in strings when we need to reference them. And the <a href="https://datatracker.ietf.org/doc/html/rfc1035#section-4.1.4">rfc 1035</a> shows us what such a pointer looks like.</p>
<h2>The pointer type</h2>
<p>So a pointer in a DNS message takes the form of 2 octets. Where the 2 first bits, needs to be set for us to know that we are dealing with a pointer. The value after the two set bits is an offset value, that points to a string token.</p>
<pre class="prism-code language-bash" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">  </span><span class="token number">1</span><span class="token operator">|</span><span class="token plain">                OFFSET                   </span><span class="token operator">|</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span></div></pre>
<p>The above image is taken from the rfc and shows the structure of a pointer-byte.</p>
<p>The offset, is a 14-bit number, this offset is counted from the first byte of the message. Pointers are distinguished from character values by the 2 first bits, since a character in a dns message can only take on 63 values (6 bits).</p>
<p>So with this information we can sort of define some rules of how to read DNS data.</p>
<h2>The rules, defining our label types!</h2>
<p>So lets say we are going to read a token from a string. A token is a part of a URL. In our earlier blogpost we saw that tokens in dns messages are prefixed by its length value and terminated with a null byte. So <code>blog.toerktumlare.com</code> is in a dns message written as <code>4blog12toerktumlare3com0</code>. So when we are reading tokens we can sort of understand that there are 3 different outcomes of bytes.</p>
<ul>
<li>A number (declaring the length of the next token)</li>
<li>A null byte (saying that our string token has ended)</li>
<li>A pointer (telling us that the token we want is at a different location in the raw message)</li>
</ul>
<p>This knowledge can give us a chart of how to read things</p>
<div><div class="mermaid">%%{init: {'theme':'dark'}}%%
flowchart LR
    A{take the first byte} --> B{Are the first 2 bits set?} -- Yes --> C{take second byte \nand parse as a u16}
    B -- No --> D{Is the entire byte set to zero?} -- Yes --> E{Parse as NullByte} 
    D -- No --> F{Parse as a length token} </div></div>
<p>We can start out by using enums to declare the 3 different label types we are going to end up with.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">enum</span><span class="token plain"> </span><span class="token type-definition class-name">CtrlByte</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">Length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">Ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">Null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>If the byte is a length byte it will contain the length as an u8. If it turns out its a pointer, the enum will contain a u16 with our 14-bit pointer value. And lastly if its a null value, we don’t really need to provide the value, because we know its zero already.</p>
<h2>Parsing a length label</h2>
<p>Im using nom to parse values and its common in nom to start out out with small parsers and then combine them into bigger parsers. So we will start out easy by using <code>take</code> to take 1  byte and we then use <code>map</code> to map it into our enum value. The function here returns a result, containing a tuple, that has the rest of the bytes, and our parsed enum.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">parse_length_byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">take</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">value</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token closure-params keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>This is a very typical nom pattern, and is a good start. This is our last reort in our flowchart we drew earlier, which means that we dont need any error hendling here because if we have gotten this war, we know that it must be a length number.</p>
<h2>Parse a null label</h2>
<p>Parsing a null byte is almost as easy. We just need to check that if the next byte is of value <code>0x00</code> and if so, we <code>map</code> it into our enum. If its not, we will return an error.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">parse_nullbyte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0x00</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">take</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">_</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token closure-params keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token macro property">make_error!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">ErrorKind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Fail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>Why we are returning an error here, is to signal that this parser failed, and nom will later use that error to understand that it should try a different parser.</p>
<h2>Parsing a pointer label</h2>
<p>Parsing bits in nom is a little bit tricker than just parsing bytes. You basically write a function that takes in a tuple that contains the bytes wyou want to parse and a <code>usize</code> value that points to which bit you are currently parsing. If you want to read more about it <a href="https://blog.adamchalmers.com/nom-bits">Adam Chandler</a> has a good blog post on how to parse bits using nom.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token type-definition class-name">BitInput</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// determine if this is a pointer</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">is_ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">BitInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token class-name">BitInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">take</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">bits</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token closure-params"> </span><span class="token closure-params keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> bits </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0b0000_0011</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// if it is a pointer, take the 14 additional bits and map into a u16</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">parse_ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">BitInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token class-name">BitInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> is_ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">is_ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> is_ptr </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">take</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">14usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">value</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token closure-params"> </span><span class="token closure-params keyword" style="color:rgb(189, 147, 249);font-style:italic">u16</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token macro property">make_error!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">ErrorKind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Fail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>Im doing this in a two step process, first we need to determine if the byte is an actual pointer by checking the first two bits. And if such is the case, we in the second step take the 14 additional bits and prase these into a u16 value that we put in our enum.</p>
<p>The type declaration at the top is just done for conveniance to avoid having to write <code>(&amp;&#x27;a [u8], usize&#x27;)</code> several times.</p>
<p>We return a <code>Err</code> here if it isn’t a pointer to trigger nom to try a different parser.</p>
<h2>Combining the parsers</h2>
<p>Now that we have our three parsers written its time to combine them. Here we can use the nom <code>alt</code> combinator to let nom try several parsers in a row, and if one fails it will alternate and try the next one until the first one succeeds.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">resolve_next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">CtrlByte</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">alt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">bits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parse_ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> parse_nullbyte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> parse_length_byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>In order to convert our bytes into bits, we need to wrap our parser in the <code>bits</code> function from nom. This will create a <em>higher order function</em> that handles bits instead of bytes.</p>
<p>Other than that this is also pretty straight forward. You provide the <code>alt</code> function with a <code>tuple</code> of functions that will get run until the first one succeeds.</p>
<h1>Parsing the actual token based on a length label</h1>
<p>We need one more parser until we are done and that is the parser that will actually read the token, based on its length. So when we know the length of the next token, we just grab that amount of bytes and convert them into a <code>str</code>. In rust all <code>String</code> are utf-8 so we convert the byte into that.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">take_token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">str</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">take</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">v</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">from_utf8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<h2>Lets recurse, lets recurse, lets recurse…</h2>
<p>Now that we have all our parts, we just need to combine it all into the final parser.</p>
<pre class="prism-code language-rust" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">parse_names</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    tokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">IResult</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">&#x27;a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> b </span><span class="token operator">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Check what the next byte is of type</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ctrl_byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resolve_next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// Match on the type parsed</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">match</span><span class="token plain"> ctrl_byte </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// If length enum, parse the next token using the length value</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// push the token onto a collection</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">take_token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> length </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    tokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_owned</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    b </span><span class="token operator">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// if ptr enum, slice the original message from the offset</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// value, and recurse using that buffer</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Ptr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parse_names</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">index </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">usize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    b </span><span class="token operator">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// if null byte enum, update the buffer, and break the loop</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token class-name">CtrlByte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Null</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    b </span><span class="token operator">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div></pre>
<p>In each iteration of the loop we need to update the buffer reference <code>b</code> to ensure that the next iteration always has the latest reference.</p>
<p>The specification does not specify if pointers can be nested, but that is the reason to why we recurse if we find a pointer. Because that pointer could in theory point to another pointer and so on.</p>
<p>At the end we join up all the tokens using a <code>.</code> as separator.</p>
<h1>Final Thoughts</h1>
<p>Compression in DNS messages is not complicated, but it was an interesting problem to solve, especially when using <code>nom</code> as the parser. I had no idea that compression existed in DNS until i read about it in the <a href="https://datatracker.ietf.org/doc/html/rfc1035">rfc 1035</a>.</p>
<p>There are several improvements that could be made, for instance here we are reparsing tokens if we hit a pointer, but if you wanted to make this more efficient one could use a <code>HashMap</code> to cache any read token, and just do lookups using the offset as the key value. Another improvement is to use a <code>BufReader</code> in rust to make reads a bit more efficient.</p>
<p>in <a href="https://datatracker.ietf.org/doc/html/rfc6891">rfc 6891</a> additional label types (bit value 0 1) was added to extend the dns protocol to be able to contain more flags. By defining the labels as enums, its very easy to just add an additional one by adding a new enum type, and a new parser. Enum types and rusts matching capabilities is very powerful to write typesafe code.</p></section><div class="tagSection__StyledWrapper-sc-1aa460q-0 dnVzXH"><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->rust</p></div><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->dns</p></div><div class="Tag__StyledWrapper-sc-1wufizg-0 crIFBs"><p class="Tag__Text-sc-1wufizg-1 cjpKMj">#<!-- -->networking</p></div></div><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#181818;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/static/688f707e139e1c5b3b1adc848f4464fb/d4bf4/selfie.avif 50w,/static/688f707e139e1c5b3b1adc848f4464fb/ee81f/selfie.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/static/688f707e139e1c5b3b1adc848f4464fb/3faea/selfie.webp 50w,/static/688f707e139e1c5b3b1adc848f4464fb/6a679/selfie.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/688f707e139e1c5b3b1adc848f4464fb/d24ee/selfie.jpg" data-srcset="/static/688f707e139e1c5b3b1adc848f4464fb/d24ee/selfie.jpg 50w,/static/688f707e139e1c5b3b1adc848f4464fb/64618/selfie.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/688f707e139e1c5b3b1adc848f4464fb/d4bf4/selfie.avif 50w,/static/688f707e139e1c5b3b1adc848f4464fb/ee81f/selfie.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/static/688f707e139e1c5b3b1adc848f4464fb/3faea/selfie.webp 50w,/static/688f707e139e1c5b3b1adc848f4464fb/6a679/selfie.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/688f707e139e1c5b3b1adc848f4464fb/d24ee/selfie.jpg" srcSet="/static/688f707e139e1c5b3b1adc848f4464fb/d24ee/selfie.jpg 50w,/static/688f707e139e1c5b3b1adc848f4464fb/64618/selfie.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><p>Written by <strong>Thomas Andolf</strong> <!-- -->I dont have twitter but i have<!-- --> <a href="https://www.linkedin.com/in/thomas-andolf-60966534">linkedin</a> <!-- -->and im on<!-- --> <a href="https://stackoverflow.com/users/1840146">stack overflow</a>.</p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/anatomy-of-dns/"><h3 class="styles__LinkText-sc-ncn1p3-0 jJcppV">← <!-- -->A DNS-message breakdown no one asked for</h3></a></li><li></li></ul></nav></main><footer><h3 class="footer__FooterText-sc-ora8l1-0 gHswLm">© <!-- -->2023<!-- -->, Built by<!-- --> <a href="http://www.github.com/tandolf">toerktumlare</a></h3></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/dns-compression/";window.___webpackCompilationHash="d47951f95e50548a2e50";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-afa68794cf9a69af341a.js"],"app":["/app-da0e5fbb4b5276d7ef81.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-6036be1a08e62eb825b9.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-72b717bd1ae7437cf1cd.js"],"component---src-pages-index-tsx":[],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-anatomy-of-dns-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-anatomy-of-dns-index-mdx-0979d3b4f78a5bb3a002.js"],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-base-64-in-rust-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-base-64-in-rust-index-mdx-6acd2f2982af7e42be63.js"],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-cve-2020-0601-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-cve-2020-0601-index-mdx-6e065da63338c67b563c.js"],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-dns-compression-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-dns-compression-index-mdx-282ea2103896fd430f1f.js"],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-hello-world-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-hello-world-index-mdx-da239a0014ab7f34b5e1.js"],"component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-monad-in-java-index-mdx":["/component---src-templates-blog-post-tsx-content-file-path-home-thomas-documents-code-js-blog-content-blog-monad-in-java-index-mdx-ba07fbb206a4681465a3.js"]};/*]]>*/</script><script src="/polyfill-afa68794cf9a69af341a.js" nomodule=""></script><script src="/app-da0e5fbb4b5276d7ef81.js" async=""></script><script src="/framework-20708a169de42a473112.js" async=""></script><script src="/webpack-runtime-7eedc861137ad0b97052.js" async=""></script></body></html>